<div class="container">
  <h4 class="d-inline p-3 mb-2 bg-light text-dark">注文履歴詳細</h4>
  <div class="row mb-1 mx-auto">
    <table class="order-detail mt-3 mb-3 ml-5">
        <tr>
          <th>購入者</th>
          <td class="order-box"><%=link_to  @order.member.last_name+@order.member.first_name, admin_member_path(@order.member) %></td>
        </tr>
        <tr>
          <th>注文日</th>
          <td class="order-box"><%= @order.created_at.strftime('%Y/%m/%d') %></td>
        </tr>
        <tr>
          <th>配送先</th>
          <td class="order-box"><%= @order.address %></td>
        </tr>
        <tr>
          <th>支払い方法</th>
          <td class="order-box"><%= @order.payment_method %></td>
        </tr>
        <th>注文ステータス</th>
        <%= form_with model: @order, url: admin_order_path, method: :PUT, local: true do |f| %>
            <td><%= f.select :order_status, Order.order_statuses.map { |k, v| [t("orderes.order_status.#{k}"), v] }, :selected=> @order.order_status_before_type_cast  %></td>
            <td><%= f.submit "更新", class: "btn btn-success" %></td>
        <% end %>
    </table>
  </div>

    <div class="row mx-auto">
      <div class="col-10 d-flex">
        <table class="table table-bordered">
          <thead class="thead-light">
            <tr>
              <th>商品名</th>
              <th>単価(税込)</th>
              <th>個数</th>
              <th>小計</th>
              <th>製作ステータス</th>
            </tr>
          </thead>

          <tbody>
            <% @order_items.each do |order| %>
            <tr>
              <td><%= order.item.name %></td>
              <td><%= (order.item.price*1.10).floor %></td>
              <td><%= order.amount %></td>
              <td><%= (order.item.price*1.10).floor*order.amount %></td>
              <%= form_with model: order, url: admin_order_item_path(order), method: :PATCH, local: true do |f| %>
                <td><%= order.making_status %></td>
                <%= f.hidden_field :order_id, :value => order.id %>
                <td><%= f.select :making_status, OrderItem.making_statuses.map { |k, v| [t("orderes.order_status.#{k}"), v] }, :selected=> order.making_status_before_type_cast %></td>
                <td><%= f.submit "更新", class: "btn btn-success" %></td>
	      		  <% end %>
            </tr>
            <% end %>
          </tbody>
        </table>

        <div class="col-5 d-flex ">
            <table class="ml-5">
            <tr>
              <td>商品合計</td>
              <td class="order-box"><%= @order.total_payment %>円</td>
            </tr>
            <tr>
              <td>送料</td>
              <td class="order-box"><%= @order.shipping_fee %>円</td>
            </tr>
            <tr>
              <td class="d-inline p-3 mb-2 bg-secondary text-white">請求金額  <i class="fas fa-hand-holding-usd"></i></td>
              <td class="h2 order-box"><%= @order.total_payment+@order.shipping_fee %>円</td>
            </tr>
            </table>
        </div>
      </div>
    </div>
</div>